/*! For license information please see chunk.5ed2b4d3b9f95f25937d.js.LICENSE.txt */
(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[8501],{83278:(e,t,r)=>{"use strict";r.d(t,{r:()=>h});var i=r(94707);const n=(e,t)=>{const r=e.startNode.parentNode,n=void 0===t?e.endNode:t.startNode,o=r.insertBefore((0,i.IW)(),n);r.insertBefore((0,i.IW)(),n);const s=new i.nt(e.options);return s.insertAfterNode(o),s},o=(e,t)=>(e.setValue(t),e.commit(),e),s=(e,t,r)=>{const n=e.startNode.parentNode,o=r?r.startNode:e.endNode,s=t.endNode.nextSibling;s!==o&&(0,i.V)(n,t.startNode,s,o)},a=e=>{(0,i.r4)(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},c=(e,t,r)=>{const i=new Map;for(let n=t;n<=r;n++)i.set(e[n],n);return i},l=new WeakMap,d=new WeakMap,h=(0,i.XM)(((e,t,r)=>{let h;return void 0===r?r=t:void 0!==t&&(h=t),t=>{if(!(t instanceof i.nt))throw new Error("repeat can only be used in text bindings");const u=l.get(t)||[],p=d.get(t)||[],f=[],m=[],v=[];let y,k,g=0;for(const t of e)v[g]=h?h(t,g):g,m[g]=r(t,g),g++;let b=0,w=u.length-1,E=0,_=m.length-1;for(;b<=w&&E<=_;)if(null===u[b])b++;else if(null===u[w])w--;else if(p[b]===v[E])f[E]=o(u[b],m[E]),b++,E++;else if(p[w]===v[_])f[_]=o(u[w],m[_]),w--,_--;else if(p[b]===v[_])f[_]=o(u[b],m[_]),s(t,u[b],f[_+1]),b++,_--;else if(p[w]===v[E])f[E]=o(u[w],m[E]),s(t,u[w],u[b]),w--,E++;else if(void 0===y&&(y=c(v,E,_),k=c(p,b,w)),y.has(p[b]))if(y.has(p[w])){const e=k.get(v[E]),r=void 0!==e?u[e]:null;if(null===r){const e=n(t,u[b]);o(e,m[E]),f[E]=e}else f[E]=o(r,m[E]),s(t,r,u[b]),u[e]=null;E++}else a(u[w]),w--;else a(u[b]),b++;for(;E<=_;){const e=n(t,f[_+1]);o(e,m[E]),f[E++]=e}for(;b<=w;){const e=u[b++];null!==e&&a(e)}l.set(t,f),d.set(t,v)}}))},12198:(e,t,r)=>{"use strict";r.d(t,{p:()=>o,D:()=>s});var i=r(68928),n=r(43274);const o=n.Sb?(e,t)=>e.toLocaleDateString(t.language,{year:"numeric",month:"long",day:"numeric"}):e=>(0,i.WU)(e,"longDate"),s=n.Sb?(e,t)=>e.toLocaleDateString(t.language,{weekday:"long",month:"short",day:"numeric"}):e=>(0,i.WU)(e,"dddd, MMM D")},49684:(e,t,r)=>{"use strict";r.d(t,{mr:()=>o,Vu:()=>s,xO:()=>a});var i=r(68928),n=r(43274);const o=n.BF?(e,t)=>e.toLocaleTimeString(t.language,{hour:"numeric",minute:"2-digit"}):e=>(0,i.WU)(e,"shortTime"),s=n.BF?(e,t)=>e.toLocaleTimeString(t.language,{hour:"numeric",minute:"2-digit",second:"2-digit"}):e=>(0,i.WU)(e,"mediumTime"),a=n.BF?(e,t)=>e.toLocaleTimeString(t.language,{weekday:"long",hour:"numeric",minute:"2-digit"}):e=>(0,i.WU)(e,"dddd, HH:mm")},5435:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});const i=[60,60,24,7],n=["second","minute","hour","day"];function o(e,t,r={}){let o=((r.compareTime||new Date).getTime()-e.getTime())/1e3;const s=o>=0?"past":"future";o=Math.abs(o);let a=Math.round(o);if(0===a)return t("ui.components.relative_time.just_now");let c="week";for(let e=0;e<i.length;e++){if(a<i[e]){c=n[e];break}o/=i[e],a=Math.round(o)}return t(!1===r.includeTense?`ui.components.relative_time.duration.${c}`:`ui.components.relative_time.${s}_duration.${c}`,"count",a)}},29171:(e,t,r)=>{"use strict";r.d(t,{D:()=>l});var i=r(56007),n=r(12198),o=r(44583),s=r(49684),a=r(45524),c=r(22311);const l=(e,t,r,l)=>{const d=void 0!==l?l:t.state;if(d===i.lz||d===i.nZ)return e(`state.default.${d}`);if(t.attributes.unit_of_measurement)return`${(0,a.u)(d,r)} ${t.attributes.unit_of_measurement}`;const h=(0,c.N)(t);if("input_datetime"===h){let e;if(!t.attributes.has_time)return e=new Date(t.attributes.year,t.attributes.month-1,t.attributes.day),(0,n.p)(e,r);if(!t.attributes.has_date){const i=new Date;return e=new Date(i.getFullYear(),i.getMonth(),i.getDay(),t.attributes.hour,t.attributes.minute),(0,s.mr)(e,r)}return e=new Date(t.attributes.year,t.attributes.month-1,t.attributes.day,t.attributes.hour,t.attributes.minute),(0,o.o)(e,r)}return"humidifier"===h&&"on"===d&&t.attributes.humidity?`${t.attributes.humidity} %`:"counter"===h||"number"===h?(0,a.u)(d,r):t.attributes.device_class&&e(`component.${h}.state.${t.attributes.device_class}.${d}`)||e(`component.${h}.state._.${d}`)||d}},45524:(e,t,r)=>{"use strict";r.d(t,{u:()=>n});var i=r(66477);const n=(e,t,r)=>{let n;switch(null==t?void 0:t.number_format){case i.y4.comma_decimal:n=["en-US","en"];break;case i.y4.decimal_comma:n=["de","es","it"];break;case i.y4.space_comma:n=["fr","sv","cs"];break;case i.y4.system:n=void 0;break;default:n=null==t?void 0:t.language}if(Number.isNaN=Number.isNaN||function e(t){return"number"==typeof t&&e(t)},!Number.isNaN(Number(e))&&Intl&&(null==t?void 0:t.number_format)!==i.y4.none)try{return new Intl.NumberFormat(n,o(e,r)).format(Number(e))}catch(t){return console.error(t),new Intl.NumberFormat(void 0,o(e,r)).format(Number(e))}return e?e.toString():""},o=(e,t)=>{const r=t||{};if("string"!=typeof e)return r;if(!t||!t.minimumFractionDigits&&!t.maximumFractionDigits){const t=e.indexOf(".")>-1?e.split(".")[1].length:0;r.minimumFractionDigits=t,r.maximumFractionDigits=t}return r}},55422:(e,t,r)=>{"use strict";r.d(t,{jV:()=>c,sS:()=>d,rM:()=>h,tf:()=>f});var i=r(49706),n=r(58831),o=r(29171),s=r(56007);const a="ui.components.logbook.messages",c=["proximity","sensor"],l={},d=async(e,t,r)=>p(e,t,void 0,void 0,void 0,r),h=async(e,t,r,i,o)=>{const s=await u(e,t,r,i,o);for(const t of s){const r=e.states[t.entity_id];t.state&&r&&(t.message=m(e,t.state,r,(0,n.M)(t.entity_id)))}return s},u=async(e,t,r,i,n)=>{const o="*";i||(i=o);const s=`${t}${r}`;if(l[s]||(l[s]={}),l[s][i])return l[s][i];if(i!==o&&l[s]["*"]){return(await l[s]["*"]).filter((e=>e.entity_id===i))}return l[s][i]=p(e,t,r,i!==o?i:void 0,n).then((e=>e.reverse())),l[s][i]},p=async(e,t,r,i,n,o)=>{const s=new URLSearchParams;return r&&s.append("end_time",r),i&&s.append("entity",i),n&&s.append("entity_matches_only",""),o&&s.append("context_id",o),e.callApi("GET",`logbook/${t}?${s.toString()}`)},f=(e,t)=>{l[`${e}${t}`]={}},m=(e,t,r,n)=>{switch(n){case"device_tracker":case"person":return"not_home"===t?e.localize(`${a}.was_away`):"home"===t?e.localize(`${a}.was_at_home`):e.localize(`${a}.was_at_state`,"state",t);case"sun":return"above_horizon"===t?e.localize(`${a}.rose`):e.localize(`${a}.set`);case"binary_sensor":{const n=t===i.uo,o=t===i.lC,s=r.attributes.device_class;switch(s){case"battery":if(n)return e.localize(`${a}.was_low`);if(o)return e.localize(`${a}.was_normal`);break;case"connectivity":if(n)return e.localize(`${a}.was_connected`);if(o)return e.localize(`${a}.was_disconnected`);break;case"door":case"garage_door":case"opening":case"window":if(n)return e.localize(`${a}.was_opened`);if(o)return e.localize(`${a}.was_closed`);break;case"lock":if(n)return e.localize(`${a}.was_unlocked`);if(o)return e.localize(`${a}.was_locked`);break;case"plug":if(n)return e.localize(`${a}.was_plugged_in`);if(o)return e.localize(`${a}.was_unplugged`);break;case"presence":if(n)return e.localize(`${a}.was_at_home`);if(o)return e.localize(`${a}.was_away`);break;case"safety":if(n)return e.localize(`${a}.was_unsafe`);if(o)return e.localize(`${a}.was_safe`);break;case"cold":case"gas":case"heat":case"moisture":case"motion":case"occupancy":case"power":case"problem":case"smoke":case"sound":case"vibration":if(n)return e.localize(`${a}.detected_device_class`,"device_class",s);if(o)return e.localize(`${a}.cleared_device_class`,"device_class",s)}break}case"cover":switch(t){case"open":return e.localize(`${a}.was_opened`);case"opening":return e.localize(`${a}.is_opening`);case"closing":return e.localize(`${a}.is_closing`);case"closed":return e.localize(`${a}.was_closed`)}break;case"lock":if("unlocked"===t)return e.localize(`${a}.was_unlocked`);if("locked"===t)return e.localize(`${a}.was_locked`)}return t===i.uo?e.localize(`${a}.turned_on`):t===i.lC?e.localize(`${a}.turned_off`):s.V_.includes(t)?e.localize(`${a}.became_unavailable`):e.localize(`${a}.changed_to_state`,"state",r?(0,o.D)(e.localize,r,e.locale,t):t)}},97389:(e,t,r)=>{"use strict";r.d(t,{mA:()=>i,lj:()=>n,U_:()=>o,nV:()=>s});const i=(e,t,r,i)=>e.callWS({type:"trace/get",domain:t,item_id:r,run_id:i}),n=(e,t,r)=>e.callWS({type:"trace/list",domain:t,item_id:r}),o=(e,t,r)=>e.callWS({type:"trace/contexts",domain:t,item_id:r}),s=(e,t)=>{const r=t.split("/").reverse();let i=e;for(;r.length;){const e=r.pop(),t=Number(e);if(isNaN(t))i=i[e];else if(Array.isArray(i))i=i[t];else if(0!==t)throw new Error("If config is not an array, can only return index 0")}return i}},88501:(e,t,r)=>{"use strict";r.r(t),r.d(t,{HaAutomationTrace:()=>Ye});var i=r(15652),n=r(97389),o=(r(25230),r(14516)),s=r(47181),a=(r(52039),r(81471));function c(){c=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach((function(r){t.forEach((function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r=e.prototype;["method","field"].forEach((function(i){t.forEach((function(t){var n=t.placement;if(t.kind===i&&("static"===n||"prototype"===n)){var o="static"===n?e:r;this.defineClassElement(o,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}Object.defineProperty(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],n={static:[],prototype:[],own:[]};if(e.forEach((function(e){this.addElementPlacement(e,n)}),this),e.forEach((function(e){if(!h(e))return r.push(e);var t=this.decorateElement(e,n);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var o=this.decorateConstructor(r,t);return i.push.apply(i,o.finishers),o.finishers=i,o},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==i.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],n=e.decorators,o=n.length-1;o>=0;o--){var s=t[e.placement];s.splice(s.indexOf(e.key),1);var a=this.fromElementDescriptor(e),c=this.toElementFinisherExtras((0,n[o])(a)||a);e=c.element,this.addElementPlacement(e,t),c.finisher&&i.push(c.finisher);var l=c.extras;if(l){for(var d=0;d<l.length;d++)this.addElementPlacement(l[d],t);r.push.apply(r,l)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var n=this.fromClassDescriptor(e),o=this.toClassDescriptor((0,t[i])(n)||n);if(void 0!==o.finisher&&r.push(o.finisher),void 0!==o.elements){e=o.elements;for(var s=0;s<e.length-1;s++)for(var a=s+1;a<e.length;a++)if(e[s].key===e[a].key&&e[s].placement===e[a].placement)throw new TypeError("Duplicated element ("+e[s].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return(t=e,function(e){if(Array.isArray(e))return e}(t)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=f(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var n=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var o={kind:t,key:r,placement:i,descriptor:Object.assign({},n)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(n,"get","The property descriptor of a field descriptor"),this.disallowProperty(n,"set","The property descriptor of a field descriptor"),this.disallowProperty(n,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:p(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=p(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function l(e){var t,r=f(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function d(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function h(e){return e.decorators&&e.decorators.length}function u(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function p(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function f(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}const v=e=>Array.isArray(e)?v(e[0]):e,y=e=>Array.isArray(e)?y(e[e.length-1]):e;function*k(e){if(Array.isArray(e))for(const t of e)yield*k(t);else yield e,e.children&&(yield*k(e.children))}!function(e,t,r,i){var n=c();if(i)for(var o=0;o<i.length;o++)n=i[o](n);var s=t((function(e){n.initializeInstanceElements(e,a.elements)}),r),a=n.decorateClass(function(e){for(var t=[],r=function(e){return"method"===e.kind&&e.key===o.key&&e.placement===o.placement},i=0;i<e.length;i++){var n,o=e[i];if("method"===o.kind&&(n=t.find(r)))if(u(o.descriptor)||u(n.descriptor)){if(h(o)||h(n))throw new ReferenceError("Duplicated methods ("+o.key+") can't be decorated.");n.descriptor=o.descriptor}else{if(h(o)){if(h(n))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+o.key+").");n.decorators=o.decorators}d(o,n)}else t.push(o)}return t}(s.d.map(l)),e);n.initializeClassElements(s.F,a.elements),n.runClassFinishers(s.F,a.finishers)}([(0,i.Mo)("hat-graph")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,i.Cb)()],key:"tree",value:void 0},{kind:"field",decorators:[(0,i.Cb)()],key:"finishedActive",value:()=>!1},{kind:"field",decorators:[(0,i.Cb)()],key:"nodeSize",value:()=>35},{kind:"field",decorators:[(0,i.Cb)()],key:"nodeSeparation",value:()=>20},{kind:"method",key:"_draw_node",value:function(e,t,r){return i.YP`
      <circle
        cx="${e}"
        cy="${t+this.nodeSize/2}"
        r="${this.nodeSize/2}"
        class="node ${(0,a.$)({active:r.isActive||!1,track:r.isTracked||!1,new:r.isNew||!1,click:!!r.clickCallback})}"
        @click=${r.clickCallback}
      />
      <g style="pointer-events: none" transform="translate(${e-12} ${t+this.nodeSize/2-12})">
        ${r.icon?i.YP`<path d="${r.icon}"/>`:""}
        ${r.number?i.YP`<g class="number"><circle r="8" cx="27" cy=0></circle>
                <text x="27" y="1"  text-anchor="middle" alignment-baseline="middle">${r.number}</text></g>`:""}
      </g>
    `}},{kind:"method",key:"_draw_new_node",value:function(e,t,r){return i.YP`
      <circle
        cx="${e}"
        cy="${t+this.nodeSize/4}"
        r="${this.nodeSize/4}"
        class="newnode"
        @click=${r.addCallback}
      />
    `}},{kind:"method",key:"_draw_connector",value:function(e,t,r,n,o){return i.YP`
      <line
        class=${(0,a.$)({track:o})}
        x1=${e}
        y1=${t}
        x2=${r}
        y2=${n}
      />
    `}},{kind:"method",key:"_draw_tree",value:function(e,t,r){return e?Array.isArray(e)?0===e.length?{svg:[],width:0,height:0,previousPartTracked:t,nextPartTracked:r,firstNodeTracked:!1,lastNodeTracked:!1}:this._draw_tree_array(e,t,r):this._draw_tree_single(e,t,r):{svg:[],width:0,height:0,previousPartTracked:t,nextPartTracked:r,firstNodeTracked:!1,lastNodeTracked:!1}}},{kind:"method",key:"_draw_tree_single",value:function(e,t,r){let n=this.nodeSize,o=this.nodeSize;const s=[];let a=e.isTracked;if(e.children&&e.children.length>0){var c;a=null===(c=v(e.children[e.children.length-1]))||void 0===c?void 0:c.isTracked;const l=[];e.children.forEach((e=>{l.push(this._draw_tree(e,t,r))})),n+=l.reduce(((e,t)=>Math.max(e,t.height)),0),o=l.reduce(((e,t)=>e+t.width),0)+this.nodeSeparation*(e.children.length-1);const d=l.map((e=>e=>0+e.width+this.nodeSeparation)());let h=!1,u=0;for(const[t,r]of l.entries()){u+=t?d[t-1]:0;const a=-o/2+u+r.width/2;s.push(this._draw_connector(0,this.nodeSize/2,a,this.nodeSize+this.nodeSeparation,r.previousPartTracked&&r.firstNodeTracked));!0!==y(e.children[t]).end&&(s.push(this._draw_connector(a,this.nodeSeparation+r.height,a,this.nodeSeparation+n,r.lastNodeTracked&&r.nextPartTracked)),s.push(this._draw_connector(a,this.nodeSeparation+n-1,0,this.nodeSeparation+n+this.nodeSize/2+this.nodeSeparation-1,r.lastNodeTracked&&r.nextPartTracked)),h=!0),s.push(i.YP`
          <g class="a" transform="translate(${a} ${this.nodeSize+this.nodeSeparation})">
          ${r.svg}
          </g>
        `)}h&&(n+=this.nodeSize+this.nodeSeparation)}return e.addCallback&&(s.push(this._draw_connector(0,n,0,n+this.nodeSeparation,e.isTracked&&r)),s.push(this._draw_new_node(0,n+this.nodeSeparation,e)),n+=this.nodeSeparation+this.nodeSize/2),!0!==e.end&&(s.push(this._draw_connector(0,n,0,n+this.nodeSeparation,e.isTracked&&r)),n+=this.nodeSeparation),s.push(this._draw_node(0,0,e)),{svg:s,width:o,height:n,previousPartTracked:t,nextPartTracked:r,firstNodeTracked:e.isTracked,lastNodeTracked:a}}},{kind:"method",key:"_draw_tree_array",value:function(e,t,r){var n,o;const s=[];let a=0;const c=[];let l=t;e.forEach(((t,i)=>{var n,o;const s=null===(n=y(t))||void 0===n?void 0:n.isTracked,a=i<e.length-1?null===(o=v(e[i+1]))||void 0===o?void 0:o.isTracked:s&&r;c.push(this._draw_tree(t,l,a)),l=s}));const d=c.reduce(((e,t)=>Math.max(e,t.width)),0);for(const[e,t]of c.entries())s.push(i.YP`
        <g class="b" transform="translate(0, ${a})">
          ${t.svg}
        </g>
      `),a+=t.height;return{svg:s,width:d,height:a,previousPartTracked:t,nextPartTracked:r,firstNodeTracked:null===(n=v(e[0]))||void 0===n?void 0:n.isTracked,lastNodeTracked:null===(o=v(e[e.length-1]))||void 0===o?void 0:o.isTracked}}},{kind:"method",key:"render",value:function(){const e=this._draw_tree(this.tree,this.tree.length>0&&this.tree[0].isTracked,this.finishedActive);return i.dy`
      <svg width=${e.width+32} height=${e.height+64}>
        <g transform="translate(${e.width/2+16} 16)">
          ${e.svg}
        </g>
      </svg>
    `}},{kind:"get",static:!0,key:"styles",value:function(){return i.iv`
      :host {
        --stroke-clr: var(--stroke-color, var(--secondary-text-color));
        --active-clr: var(--active-color, var(--primary-color));
        --hover-clr: var(--hover-color, var(--primary-color));
        --track-clr: var(--track-color, var(--accent-color));
      }
      circle,
      line {
        stroke: var(--stroke-clr);
        stroke-width: 3px;
        fill: white;
      }
      .click {
        cursor: pointer;
      }
      .click:hover {
        stroke: var(--hover-clr);
      }
      .track {
        stroke: var(--track-clr);
      }
      .active {
        stroke: var(--active-clr);
      }
      .number circle {
        fill: var(--track-clr);
        stroke: none;
      }
      .number text {
        font-size: smaller;
      }
    `}}]}}),i.oi);var g=r(55317);function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const w={new:g.AD$,device_id:g.p0g,service:g.zrb,condition:g._wd,TRUE:g.oL1,FALSE:g.r5M,delay:g.clR,wait_template:g._yq,event:g.XW6,repeat:g.jcD,repeatReturn:g.XHH,choose:g.g$R,chooseChoice:g.Eut,chooseDefault:g.Ii0,YAML:g.UgG},E=["condition","delay","device_id","event","scene","service","wait_template","repeat","choose"],_="action/";class P{constructor(e,t,r,i,n="",s,a,c){this.actions=e,this.allowAdd=t,this.updateCallback=r,this.selectCallback=i,this.selected=n,this.trace=s,this.end=c,b(this,"pathPrefix",void 0),b(this,"_createGraph",(0,o.Z)(((e,t,r)=>this._renderTraceHead().concat(this.actions.map(((e,t)=>this._createTreeNode(t,e,this.actions.length===t+1&&(void 0===this.end||!0===this.end)))))))),b(this,"SPECIAL",{condition:(e,t,r)=>this._createConditionNode(this.pathPrefix,e,t,r),repeat:(e,t,r)=>{var i;let n=t.repeat.sequence;n&&n.length||(n=[{}]);const o=`${this.pathPrefix}${e}`,s=this.trace&&o in this.trace.trace,a=this.trace&&(null===(i=this.trace.trace[`${o}/repeat/sequence/0`])||void 0===i?void 0:i.length),c={path:o,config:t,update:t=>this._updateAction(e,t)};return{icon:w.repeat,number:a,nodeInfo:c,clickCallback:()=>this._selectNode(c),isActive:o===this.selected,isTracked:s,end:r,children:[new P(n,this.allowAdd,(r=>{t.repeat.sequence=r,this._updateAction(e,t)}),(e=>this._selectNode(e)),this.selected,this.trace,`${o}/repeat/sequence/`,r).createGraph()]}},choose:(e,t,r)=>{var i;const n=`${this.pathPrefix}${e}`;let o;if((null===(i=this.trace)||void 0===i?void 0:i.trace)&&n in this.trace.trace){o=this.trace.trace[n][0].result.choice}const s=t.choose.map(((i,n)=>{const o=`${this.pathPrefix}${e}/choose/${n}`;let s=!1;if(this.trace&&o in this.trace.trace){s=this.trace.trace[o][0].result.result}const a={path:o,config:i,update:r=>{t.choose[n]=r,this._updateAction(e,t)}};return[{icon:w.chooseChoice,nodeInfo:a,clickCallback:()=>this._selectNode(a),isActive:o===this.selected,isTracked:s},new P(i.sequence||[{}],this.allowAdd,(r=>{i.sequence=r,t.choose[n]=i,this._updateAction(e,t)}),(e=>{this._selectNode(e)}),this.selected,this.trace,`${this.pathPrefix}${e}/choose/${n}/sequence/`,!s||r).createGraph()]}));if(t.default||this.allowAdd){const i=t.default||[{}],n=r=>{t.default=r,this._updateAction(e,t)},a=`${this.pathPrefix}${e}/default`,c={path:a,config:i,update:n};s.push([{icon:w.chooseDefault,nodeInfo:c,clickCallback:()=>this._selectNode(c),isActive:a===this.selected,isTracked:"default"===o},new P(i,this.allowAdd,n,(e=>this._selectNode(e)),this.selected,this.trace,`${this.pathPrefix}${e}/default/`,"default"!==o||r).createGraph()])}const a={path:n,config:t,update:t=>this._updateAction(e,t)};return{icon:w.choose,nodeInfo:a,end:r,clickCallback:()=>this._selectNode(a),isActive:n===this.selected,isTracked:void 0!==o,children:s}}}),void 0!==a?this.pathPrefix=a:this.trace?this.pathPrefix=_:this.pathPrefix=""}createGraph(){return this._createGraph(this.actions,this.selected,this.trace)}_renderTraceHead(){if(this.pathPrefix!==_)return[];const e={path:"trigger",config:this.trace.config.trigger},t=[{icon:g.XVW,nodeInfo:e,clickCallback:()=>{this._selectNode(e)},isActive:"trigger"===this.selected,isTracked:!0}];return this.trace.config.condition&&this.trace.config.condition.forEach(((e,r)=>t.push(this._createConditionNode("condition/",r,e,!this.actions.length&&this.trace.config.condition.length===r+1)))),t}_updateAction(e,t){null===t?this.actions.splice(e,1):this.actions[e]=t,this.updateCallback&&this.updateCallback(this.actions)}_addAction(e){this.actions.splice(e,0,{}),this.updateCallback&&this.updateCallback(this.actions),this._selectNode({path:`${this.pathPrefix}${e}`,config:{},update:t=>this._updateAction(e,t)})}_selectNode(e){this.selected=e.path,this.selectCallback&&this.selectCallback(e)}_createTreeNode(e,t,r){let i,n="yaml";if(n=0===Object.keys(t).length?"new":E.find((e=>e in t))||"YAML",n in this.SPECIAL)i=this.SPECIAL[n](e,t,r);else{const o=`${this.pathPrefix}${e}`,s={path:o,config:t,update:t=>this._updateAction(e,t)};i={icon:w[n],nodeInfo:s,clickCallback:()=>{this._selectNode(s)},isActive:o===this.selected,isTracked:this.trace&&o in this.trace.trace,end:r}}return this.allowAdd&&(i.addCallback=()=>this._addAction(e+1)),"new"===n&&(i.isNew=!0),i}_createConditionNode(e,t,r,i){const n=`${e}${t}`;let o,s=!1;if(this.trace&&n in this.trace.trace){o=this.trace.trace[n][0].result.result,s=!0}const a={path:n,config:r,update:e=>this._updateAction(t,e)},c=n===this.selected;return{icon:w.condition,nodeInfo:a,clickCallback:()=>this._selectNode(a),isActive:c,isTracked:s,end:i,children:[{icon:w.TRUE,clickCallback:()=>this._selectNode(a),isActive:c,isTracked:!0===o},{icon:w.FALSE,clickCallback:()=>this._selectNode(a),isActive:c,isTracked:!1===o,end:!0}]}}}function T(){T=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach((function(r){t.forEach((function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r=e.prototype;["method","field"].forEach((function(i){t.forEach((function(t){var n=t.placement;if(t.kind===i&&("static"===n||"prototype"===n)){var o="static"===n?e:r;this.defineClassElement(o,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}Object.defineProperty(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],n={static:[],prototype:[],own:[]};if(e.forEach((function(e){this.addElementPlacement(e,n)}),this),e.forEach((function(e){if(!D(e))return r.push(e);var t=this.decorateElement(e,n);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var o=this.decorateConstructor(r,t);return i.push.apply(i,o.finishers),o.finishers=i,o},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==i.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],n=e.decorators,o=n.length-1;o>=0;o--){var s=t[e.placement];s.splice(s.indexOf(e.key),1);var a=this.fromElementDescriptor(e),c=this.toElementFinisherExtras((0,n[o])(a)||a);e=c.element,this.addElementPlacement(e,t),c.finisher&&i.push(c.finisher);var l=c.extras;if(l){for(var d=0;d<l.length;d++)this.addElementPlacement(l[d],t);r.push.apply(r,l)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var n=this.fromClassDescriptor(e),o=this.toClassDescriptor((0,t[i])(n)||n);if(void 0!==o.finisher&&r.push(o.finisher),void 0!==o.elements){e=o.elements;for(var s=0;s<e.length-1;s++)for(var a=s+1;a<e.length;a++)if(e[s].key===e[a].key&&e[s].placement===e[a].placement)throw new TypeError("Duplicated element ("+e[s].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return(t=e,function(e){if(Array.isArray(e))return e}(t)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=S(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var n=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var o={kind:t,key:r,placement:i,descriptor:Object.assign({},n)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(n,"get","The property descriptor of a field descriptor"),this.disallowProperty(n,"set","The property descriptor of a field descriptor"),this.disallowProperty(n,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:C(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=C(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function $(e){var t,r=S(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function x(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function D(e){return e.decorators&&e.decorators.length}function A(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function C(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function S(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function z(e,t,r){return(z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e,t,r,i){var n=T();if(i)for(var o=0;o<i.length;o++)n=i[o](n);var s=t((function(e){n.initializeInstanceElements(e,a.elements)}),r),a=n.decorateClass(function(e){for(var t=[],r=function(e){return"method"===e.kind&&e.key===o.key&&e.placement===o.placement},i=0;i<e.length;i++){var n,o=e[i];if("method"===o.kind&&(n=t.find(r)))if(A(o.descriptor)||A(n.descriptor)){if(D(o)||D(n))throw new ReferenceError("Duplicated methods ("+o.key+") can't be decorated.");n.descriptor=o.descriptor}else{if(D(o)){if(D(n))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+o.key+").");n.decorators=o.decorators}x(o,n)}else t.push(o)}return t}(s.d.map($)),e);n.initializeClassElements(s.F,a.elements),n.runClassFinishers(s.F,a.finishers)}([(0,i.Mo)("hat-script-graph")],(function(e,t){class r extends t{constructor(...t){super(...t),e(this)}}return{F:r,d:[{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"trace",value:void 0},{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"selected",value:void 0},{kind:"field",key:"getActionHandler",value(){return(0,o.Z)((e=>new P(e.config.action,!1,void 0,(e=>{console.log(e),(0,s.B)(this,"graph-node-selected",e),this.requestUpdate()}),this.selected,this.trace)))}},{kind:"method",key:"render",value:function(){const e=this.getActionHandler(this.trace),t=Object.keys(this.getTrackedNodes());return i.dy`
      <hat-graph .tree=${e.createGraph()}></hat-graph>
      <div class="actions">
        <mwc-icon-button
          .disabled=${0===t.length||t[0]===this.selected}
          @click=${this.previousTrackedNode}
        >
          <ha-svg-icon .path=${g.Waq}></ha-svg-icon>
        </mwc-icon-button>
        <mwc-icon-button
          .disabled=${0===t.length||t[t.length-1]===this.selected}
          @click=${this.nextTrackedNode}
        >
          <ha-svg-icon .path=${g.CW}></ha-svg-icon>
        </mwc-icon-button>
      </div>
    `}},{kind:"method",key:"selectPath",value:function(e){var t;const r=this.getActionHandler(this.trace);let i;for(const t of r.createGraph()){var n;if((null===(n=t.nodeInfo)||void 0===n?void 0:n.path)===e){i=t.nodeInfo;break}}r.selected=(null===(t=i)||void 0===t?void 0:t.path)||"",this.requestUpdate()}},{kind:"method",key:"updated",value:function(e){if(z(O(r.prototype),"updated",this).call(this,e),e.has("trace")){const e=this.getTrackedNodes(),t=Object.keys(e);if(""===this.selected||!(this.selected in t))for(const r of t)if(e[r].nodeInfo){(0,s.B)(this,"graph-node-selected",e[r].nodeInfo);break}}e.has("selected")&&(this.getActionHandler(this.trace).selected=this.selected,this.requestUpdate())}},{kind:"method",key:"getTrackedNodes",value:function(){return this._getTrackedNodes(this.trace)}},{kind:"method",key:"previousTrackedNode",value:function(){const e=this.getTrackedNodes(),t=Object.keys(e);for(let r=t.indexOf(this.selected)-1;r>=0;r--)if(e[t[r]].nodeInfo){(0,s.B)(this,"graph-node-selected",e[t[r]].nodeInfo);break}}},{kind:"method",key:"nextTrackedNode",value:function(){const e=this.getTrackedNodes(),t=Object.keys(e);for(let r=t.indexOf(this.selected)+1;r<t.length;r++)if(e[t[r]].nodeInfo){(0,s.B)(this,"graph-node-selected",e[t[r]].nodeInfo);break}}},{kind:"field",key:"_getTrackedNodes",value(){return(0,o.Z)((e=>{const t={};for(const r of k(this.getActionHandler(e).createGraph()))r.isTracked&&r.nodeInfo&&(t[r.nodeInfo.path]=r);return t}))}},{kind:"get",static:!0,key:"styles",value:function(){return i.iv`
      :host {
        display: flex;
      }
      .actions {
        display: flex;
        flex-direction: column;
      }
    `}}]}}),i.oi);var j=r(11654),N=r(29311),F=r(55422),R=r(44583),M=r(83278),U=r(26765),L=r(50947);r(10983),r(53822);const B=i.iv`
  .tabs {
    background-color: var(--primary-background-color);
    border-top: 1px solid var(--divider-color);
    border-bottom: 1px solid var(--divider-color);
    display: flex;
    padding-left: 4px;
  }

  .tabs.top {
    border-top: none;
  }

  .tabs > * {
    padding: 2px 16px;
    cursor: pointer;
    position: relative;
    bottom: -1px;
    border-bottom: 2px solid transparent;
    user-select: none;
  }

  .tabs > *.active {
    border-bottom-color: var(--accent-color);
  }
`;function q(){q=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach((function(r){t.forEach((function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r=e.prototype;["method","field"].forEach((function(i){t.forEach((function(t){var n=t.placement;if(t.kind===i&&("static"===n||"prototype"===n)){var o="static"===n?e:r;this.defineClassElement(o,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}Object.defineProperty(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],n={static:[],prototype:[],own:[]};if(e.forEach((function(e){this.addElementPlacement(e,n)}),this),e.forEach((function(e){if(!V(e))return r.push(e);var t=this.decorateElement(e,n);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var o=this.decorateConstructor(r,t);return i.push.apply(i,o.finishers),o.finishers=i,o},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==i.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],n=e.decorators,o=n.length-1;o>=0;o--){var s=t[e.placement];s.splice(s.indexOf(e.key),1);var a=this.fromElementDescriptor(e),c=this.toElementFinisherExtras((0,n[o])(a)||a);e=c.element,this.addElementPlacement(e,t),c.finisher&&i.push(c.finisher);var l=c.extras;if(l){for(var d=0;d<l.length;d++)this.addElementPlacement(l[d],t);r.push.apply(r,l)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var n=this.fromClassDescriptor(e),o=this.toClassDescriptor((0,t[i])(n)||n);if(void 0!==o.finisher&&r.push(o.finisher),void 0!==o.elements){e=o.elements;for(var s=0;s<e.length-1;s++)for(var a=s+1;a<e.length;a++)if(e[s].key===e[a].key&&e[s].placement===e[a].placement)throw new TypeError("Duplicated element ("+e[s].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return(t=e,function(e){if(Array.isArray(e))return e}(t)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return X(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?X(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=Z(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var n=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var o={kind:t,key:r,placement:i,descriptor:Object.assign({},n)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(n,"get","The property descriptor of a field descriptor"),this.disallowProperty(n,"set","The property descriptor of a field descriptor"),this.disallowProperty(n,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:Y(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=Y(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function W(e){var t,r=Z(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function H(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function V(e){return e.decorators&&e.decorators.length}function G(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function Y(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function Z(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}!function(e,t,r,i){var n=q();if(i)for(var o=0;o<i.length;o++)n=i[o](n);var s=t((function(e){n.initializeInstanceElements(e,a.elements)}),r),a=n.decorateClass(function(e){for(var t=[],r=function(e){return"method"===e.kind&&e.key===o.key&&e.placement===o.placement},i=0;i<e.length;i++){var n,o=e[i];if("method"===o.kind&&(n=t.find(r)))if(G(o.descriptor)||G(n.descriptor)){if(V(o)||V(n))throw new ReferenceError("Duplicated methods ("+o.key+") can't be decorated.");n.descriptor=o.descriptor}else{if(V(o)){if(V(n))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+o.key+").");n.decorators=o.decorators}H(o,n)}else t.push(o)}return t}(s.d.map(W)),e);n.initializeClassElements(s.F,a.elements),n.runClassFinishers(s.F,a.finishers)}([(0,i.Mo)("ha-automation-trace-path-details")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,i.Cb)({type:Boolean,reflect:!0})],key:"narrow",value:void 0},{kind:"field",decorators:[(0,i.Cb)()],key:"selected",value:void 0},{kind:"field",decorators:[(0,i.Cb)()],key:"trace",value:void 0},{kind:"field",decorators:[(0,i.Cb)()],key:"logbookEntries",value:void 0},{kind:"field",decorators:[(0,i.Cb)()],key:"trackedNodes",value:void 0},{kind:"field",decorators:[(0,i.sz)()],key:"_view",value:()=>"config"},{kind:"method",key:"render",value:function(){return i.dy`
      <div class="padded-box trace-info">
        ${this._renderSelectedTraceInfo()}
      </div>

      <div class="tabs top">
        ${[["config","Step Config"],["changed_variables","Changed Variables"],["logbook","Related logbook entries"]].map((([e,t])=>i.dy`
            <div
              .view=${e}
              class=${(0,a.$)({active:this._view===e})}
              @click=${this._showTab}
            >
              ${t}
            </div>
          `))}
      </div>
      ${"config"===this._view?this._renderSelectedConfig():"changed_variables"===this._view?this._renderChangedVars():this._renderLogbook()}
    `}},{kind:"method",key:"_renderSelectedTraceInfo",value:function(){var e;const t=this.trace.trace;if(!(null===(e=this.selected)||void 0===e?void 0:e.path))return"Select a node on the left for more information.";const r=this.selected.path.split("/");if("default"===r[r.length-1]){var n,o;const e=t[r.slice(0,r.length-1).join("/")];if(e&&"default"===(null===(n=e[0])||void 0===n||null===(o=n.result)||void 0===o?void 0:o.choice))return"The default node was executed because no choices matched."}if(!(this.selected.path in t))return"This node was not executed and so no further trace information is available.";const s=t[this.selected.path];return s.map(((e,t)=>{const{path:r,timestamp:n,result:o,changed_variables:a,...c}=e;return i.dy`
        ${1===s.length?"":i.dy`<h3>Iteration ${t+1}</h3>`}
        Executed:
        ${(0,R.E)(new Date(n),this.hass.locale)}<br />
        ${o?i.dy`Result:
              <pre>${(0,L.safeDump)(o)}</pre>`:""}
        ${0===Object.keys(c).length?"":i.dy`<pre>${(0,L.safeDump)(c)}</pre>`}
      `}))}},{kind:"method",key:"_renderSelectedConfig",value:function(){var e;if(!(null===(e=this.selected)||void 0===e?void 0:e.path))return"";const t=(0,n.nV)(this.trace.config,this.selected.path);return t?i.dy`<ha-code-editor
          .value=${(0,L.safeDump)(t).trimRight()}
          readOnly
        ></ha-code-editor>`:"Unable to find config"}},{kind:"method",key:"_renderChangedVars",value:function(){const e=this.trace.trace[this.selected.path];return i.dy`
      <div class="padded-box">
        ${e.map(((e,t)=>i.dy`
            ${t>0?i.dy`<p>Iteration ${t+1}</p>`:""}
            ${0===Object.keys(e.changed_variables||{}).length?"No variables changed":i.dy`<pre>
${(0,L.safeDump)(e.changed_variables).trimRight()}</pre
                >`}
          `))}
      </div>
    `}},{kind:"method",key:"_renderLogbook",value:function(){const e=this.trace.trace,t=e[this.selected.path],r=Object.keys(this.trackedNodes),n=r.indexOf(this.selected.path);if(-1===n)return i.dy`<div class="padded-box">Node not tracked.</div>`;let o;if(n===r.length-1){const e=new Date(t[0].timestamp),r=this.logbookEntries.findIndex((t=>new Date(t.when)>=e));o=-1===r?[]:this.logbookEntries.slice(r)}else{const i=e[r[n+1]],s=new Date(t[0].timestamp),a=new Date(i[0].timestamp);o=[];for(const e of this.logbookEntries||[]){const t=new Date(e.when);if(t>=s){if(!(t<a))break;o.push(e)}}}return i.dy`<div class="padded-box">
      ${o.map((e=>i.dy`${e.name} (${e.entity_id})
            ${e.message||`turned ${e.state}`}<br />`))}
    </div>`}},{kind:"method",key:"_showTab",value:function(e){this._view=e.target.view}},{kind:"get",static:!0,key:"styles",value:function(){return[B,i.iv`
        .padded-box {
          margin: 16px;
        }

        :host(:not([narrow])) .trace-info {
          min-height: 250px;
        }

        pre {
          margin: 0;
        }
      `]}}]}}),i.oi);function K(){K=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach((function(r){t.forEach((function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r=e.prototype;["method","field"].forEach((function(i){t.forEach((function(t){var n=t.placement;if(t.kind===i&&("static"===n||"prototype"===n)){var o="static"===n?e:r;this.defineClassElement(o,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}Object.defineProperty(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],n={static:[],prototype:[],own:[]};if(e.forEach((function(e){this.addElementPlacement(e,n)}),this),e.forEach((function(e){if(!ee(e))return r.push(e);var t=this.decorateElement(e,n);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var o=this.decorateConstructor(r,t);return i.push.apply(i,o.finishers),o.finishers=i,o},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==i.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],n=e.decorators,o=n.length-1;o>=0;o--){var s=t[e.placement];s.splice(s.indexOf(e.key),1);var a=this.fromElementDescriptor(e),c=this.toElementFinisherExtras((0,n[o])(a)||a);e=c.element,this.addElementPlacement(e,t),c.finisher&&i.push(c.finisher);var l=c.extras;if(l){for(var d=0;d<l.length;d++)this.addElementPlacement(l[d],t);r.push.apply(r,l)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var n=this.fromClassDescriptor(e),o=this.toClassDescriptor((0,t[i])(n)||n);if(void 0!==o.finisher&&r.push(o.finisher),void 0!==o.elements){e=o.elements;for(var s=0;s<e.length-1;s++)for(var a=s+1;a<e.length;a++)if(e[s].key===e[a].key&&e[s].placement===e[a].placement)throw new TypeError("Duplicated element ("+e[s].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return(t=e,function(e){if(Array.isArray(e))return e}(t)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return ne(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ne(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=ie(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var n=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var o={kind:t,key:r,placement:i,descriptor:Object.assign({},n)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(n,"get","The property descriptor of a field descriptor"),this.disallowProperty(n,"set","The property descriptor of a field descriptor"),this.disallowProperty(n,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:re(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=re(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function J(e){var t,r=ie(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function Q(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function ee(e){return e.decorators&&e.decorators.length}function te(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function re(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function ie(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}!function(e,t,r,i){var n=K();if(i)for(var o=0;o<i.length;o++)n=i[o](n);var s=t((function(e){n.initializeInstanceElements(e,a.elements)}),r),a=n.decorateClass(function(e){for(var t=[],r=function(e){return"method"===e.kind&&e.key===o.key&&e.placement===o.placement},i=0;i<e.length;i++){var n,o=e[i];if("method"===o.kind&&(n=t.find(r)))if(te(o.descriptor)||te(n.descriptor)){if(ee(o)||ee(n))throw new ReferenceError("Duplicated methods ("+o.key+") can't be decorated.");n.descriptor=o.descriptor}else{if(ee(o)){if(ee(n))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+o.key+").");n.decorators=o.decorators}Q(o,n)}else t.push(o)}return t}(s.d.map(J)),e);n.initializeClassElements(s.F,a.elements),n.runClassFinishers(s.F,a.finishers)}([(0,i.Mo)("ha-timeline")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,i.Cb)({type:Boolean,reflect:!0})],key:"label",value:()=>!1},{kind:"field",decorators:[(0,i.Cb)({type:Boolean,reflect:!0})],key:"raised",value:()=>!1},{kind:"field",decorators:[(0,i.Cb)({type:Boolean})],key:"lastItem",value:()=>!1},{kind:"field",decorators:[(0,i.Cb)({type:String})],key:"icon",value:void 0},{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"moreItems",value:void 0},{kind:"field",decorators:[(0,i.sz)()],key:"_showMore",value:()=>!1},{kind:"method",key:"render",value:function(){return i.dy`
      <div class="timeline-start">
        ${this.label?"":i.dy`
              <ha-svg-icon .path=${this.icon||g.KS$}></ha-svg-icon>
            `}
        ${this.lastItem?"":i.dy`<div class="line"></div>`}
      </div>
      <div class="content">
        <slot></slot>
        ${this.moreItems?i.dy`
              <div>
                ${this._showMore||1===this.moreItems.length?this.moreItems:i.dy`
                      <button class="link" @click=${this._handleShowMore}>
                        Show ${this.moreItems.length} more items
                      </button>
                    `}
              </div>
            `:""}
      </div>
    `}},{kind:"method",key:"_handleShowMore",value:function(){this._showMore=!0}},{kind:"get",static:!0,key:"styles",value:function(){return[i.iv`
        :host {
          display: flex;
          flex-direction: row;
        }
        :host(:not([lastItem])) {
          min-height: 50px;
        }
        :host([label]) {
          margin-top: -8px;
          font-style: italic;
          color: var(--timeline-label-color, var(--secondary-text-color));
        }
        .timeline-start {
          display: flex;
          flex-direction: column;
          align-items: center;
          margin-right: 8px;
          width: 24px;
        }
        ha-svg-icon {
          color: var(
            --timeline-ball-color,
            var(--timeline-color, var(--secondary-text-color))
          );
          border-radius: 50%;
        }
        :host([raised]) ha-svg-icon {
          transform: scale(1.3);
        }
        .line {
          flex: 1;
          width: 2px;
          background-color: var(
            --timeline-line-color,
            var(--timeline-color, var(--secondary-text-color))
          );
          margin: 4px 0;
        }
        .content {
          margin-top: 2px;
        }
        :host(:not([lastItem])) .content {
          padding-bottom: 16px;
        }
        :host([label]) .content {
          margin-top: 0;
          padding-top: 6px;
        }
      `,j.k1]}}]}}),i.oi);var oe=r(44547),se=r(5435);function ae(){ae=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach((function(r){t.forEach((function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r=e.prototype;["method","field"].forEach((function(i){t.forEach((function(t){var n=t.placement;if(t.kind===i&&("static"===n||"prototype"===n)){var o="static"===n?e:r;this.defineClassElement(o,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}Object.defineProperty(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],n={static:[],prototype:[],own:[]};if(e.forEach((function(e){this.addElementPlacement(e,n)}),this),e.forEach((function(e){if(!de(e))return r.push(e);var t=this.decorateElement(e,n);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var o=this.decorateConstructor(r,t);return i.push.apply(i,o.finishers),o.finishers=i,o},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==i.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],n=e.decorators,o=n.length-1;o>=0;o--){var s=t[e.placement];s.splice(s.indexOf(e.key),1);var a=this.fromElementDescriptor(e),c=this.toElementFinisherExtras((0,n[o])(a)||a);e=c.element,this.addElementPlacement(e,t),c.finisher&&i.push(c.finisher);var l=c.extras;if(l){for(var d=0;d<l.length;d++)this.addElementPlacement(l[d],t);r.push.apply(r,l)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var n=this.fromClassDescriptor(e),o=this.toClassDescriptor((0,t[i])(n)||n);if(void 0!==o.finisher&&r.push(o.finisher),void 0!==o.elements){e=o.elements;for(var s=0;s<e.length-1;s++)for(var a=s+1;a<e.length;a++)if(e[s].key===e[a].key&&e[s].placement===e[a].placement)throw new TypeError("Duplicated element ("+e[s].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return(t=e,function(e){if(Array.isArray(e))return e}(t)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return fe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?fe(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=pe(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var n=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var o={kind:t,key:r,placement:i,descriptor:Object.assign({},n)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(n,"get","The property descriptor of a field descriptor"),this.disallowProperty(n,"set","The property descriptor of a field descriptor"),this.disallowProperty(n,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:ue(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=ue(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function ce(e){var t,r=pe(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function le(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function de(e){return e.decorators&&e.decorators.length}function he(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function ue(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function pe(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function me(e,t,r){return(me="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ve(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function ve(e){return(ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ye(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ke=(e,t)=>Math.abs(t.getTime()-e.getTime())>1e3;class ge{constructor(e,t,r){this.hass=e,this.entries=t,ye(this,"lastReportedTime",void 0),this.lastReportedTime=new Date(r.timestamp.start)}setLastReportedTime(e){this.lastReportedTime=e}renderTime(e,t){this.entries.push(i.dy`
      <ha-timeline label>
        ${(0,se.Z)(e,this.hass.localize,{compareTime:t,includeTense:!1})}
        later
      </ha-timeline>
    `),this.lastReportedTime=t}maybeRenderTime(e){return ke(e,this.lastReportedTime)?(this.renderTime(this.lastReportedTime,e),!0):(this.lastReportedTime=e,!1)}}class be{constructor(e,t,r){this.entries=e,this.timeTracker=t,this.logbookEntries=r,ye(this,"curIndex",void 0),ye(this,"pendingItems",[]),this.curIndex=r.length>0&&"automation"===r[0].domain?1:0}get curItem(){return this.logbookEntries[this.curIndex]}get hasNext(){return this.curIndex!==this.logbookEntries.length}maybeRenderItem(){const e=this.curItem;this.curIndex++;const t=new Date(e.when);if(0===this.pendingItems.length)return void this.pendingItems.push([t,e]);const r=this.pendingItems[this.pendingItems.length-1][0];ke(r,t)&&(this._renderLogbookEntries(),this.timeTracker.renderTime(r,t)),this.pendingItems.push([t,e])}flush(){this.pendingItems.length>0&&this._renderLogbookEntries()}_renderLogbookEntries(){this.timeTracker.maybeRenderTime(this.pendingItems[0][0]);const e=[];let t,r;for(t=0;t<Math.min(this.pendingItems.length,2);t++)e.push(this._renderLogbookEntryHelper(this.pendingItems[t][1]));if(t<this.pendingItems.length)for(r=[];t<this.pendingItems.length;t++)r.push(this._renderLogbookEntryHelper(this.pendingItems[t][1]));this.entries.push(i.dy`
      <ha-timeline .icon=${g.KS$} .moreItems=${r}>
        ${e}
      </ha-timeline>
    `),this.timeTracker.setLastReportedTime(this.pendingItems[this.pendingItems.length-1][0]),this.pendingItems=[]}_renderLogbookEntryHelper(e){return i.dy`${e.name} (${e.entity_id})
      ${e.message||`turned ${e.state}`}<br />`}}class we{constructor(e,t,r,i,n){this.hass=e,this.entries=t,this.trace=r,this.logbookRenderer=i,this.timeTracker=n,ye(this,"curIndex",0),ye(this,"keys",void 0),this.keys=Object.keys(r.trace)}get curItem(){return this._getItem(this.curIndex)}get hasNext(){return this.curIndex!==this.keys.length}renderItem(){this.curIndex=this._renderItem(this.curIndex)}_getItem(e){return this.trace.trace[this.keys[e]]}_renderItem(e,t){const r=this._getItem(e);if("trigger"===r[0].path)return this._handleTrigger(e,r[0]);const o=new Date(r[0].timestamp);for(;this.logbookRenderer.hasNext&&new Date(this.logbookRenderer.curItem.when)<o;)this.logbookRenderer.maybeRenderItem();this.logbookRenderer.flush(),this.timeTracker.maybeRenderTime(o);const s=r[0].path;let a;try{a=(0,n.nV)(this.trace.config,s)}catch(t){return this.entries.push(i.dy`Unable to extract path ${s}. Download trace and report as bug`),e+1}return 2===s.split("/").length||t?(t||(t=(0,oe.Pw)(a)),"choose"===t?this._handleChoose(e):(this._renderEntry(s,a.alias||t),e+1)):(this._renderEntry(s,s.replace(/\//g," ")),e+1)}_handleTrigger(e,t){return this._renderEntry("trigger",`Triggered by the\n    ${t.changed_variables.trigger.description} at\n    ${(0,R.E)(new Date(t.timestamp),this.hass.locale)}`,g.mdD),e+1}_handleChoose(e){const t=this.keys[e],r=t.split("/").length-1,i=this._getItem(e)[0],n="default"===i.result.choice,o=this._getDataFromPath(this.keys[e]).alias||"Choose";if(n)this._renderEntry(t,`${o}: Default action executed`);else{const r=this._getDataFromPath(`${this.keys[e]}/choose/${i.result.choice}`).alias||`Choice ${i.result.choice}`;this._renderEntry(t,`${o}: ${r} executed`)}let s;for(s=e+1;s<this.keys.length;s++){const e=this.keys[s].split("/");if(e.length<=r)return s;if("sequence"===e[r+3])break}for(;s<this.keys.length;){const e=this.keys[s];if(e.split("/").length<=r)return s;s=this._renderItem(s,(0,oe.Pw)(this._getDataFromPath(e)))}return s}_renderEntry(e,t,r=g.U3w){this.entries.push(i.dy`
      <ha-timeline .icon=${r} data-path=${e}>
        ${t}
      </ha-timeline>
    `)}_getDataFromPath(e){return(0,n.nV)(this.trace.config,e)}}!function(e,t,r,i){var n=ae();if(i)for(var o=0;o<i.length;o++)n=i[o](n);var s=t((function(e){n.initializeInstanceElements(e,a.elements)}),r),a=n.decorateClass(function(e){for(var t=[],r=function(e){return"method"===e.kind&&e.key===o.key&&e.placement===o.placement},i=0;i<e.length;i++){var n,o=e[i];if("method"===o.kind&&(n=t.find(r)))if(he(o.descriptor)||he(n.descriptor)){if(de(o)||de(n))throw new ReferenceError("Duplicated methods ("+o.key+") can't be decorated.");n.descriptor=o.descriptor}else{if(de(o)){if(de(n))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+o.key+").");n.decorators=o.decorators}le(o,n)}else t.push(o)}return t}(s.d.map(ce)),e);n.initializeClassElements(s.F,a.elements),n.runClassFinishers(s.F,a.finishers)}([(0,i.Mo)("hat-trace-timeline")],(function(e,t){class r extends t{constructor(...t){super(...t),e(this)}}return{F:r,d:[{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"trace",value:void 0},{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"logbookEntries",value:void 0},{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"selectedPath",value:void 0},{kind:"field",decorators:[(0,i.Cb)({type:Boolean})],key:"allowPick",value:()=>!1},{kind:"method",key:"render",value:function(){if(!this.trace)return i.dy``;const e=[],t=new ge(this.hass,e,this.trace),r=new be(e,t,this.logbookEntries||[]),n=new we(this.hass,e,this.trace,r,t);for(;n.hasNext;)n.renderItem();for(;r.hasNext;)r.maybeRenderItem();return r.flush(),null!==this.trace.last_action&&e.push(i.dy`
        <ha-timeline
          lastItem
          .icon=${this.trace.timestamp.finish?g.mdD:g.Amr}
        >
          ${this.trace.timestamp.finish?i.dy`Finished at
              ${(0,R.E)(new Date(this.trace.timestamp.finish),this.hass.locale)}
              (runtime:
              ${((new Date(this.trace.timestamp.finish).getTime()-new Date(this.trace.timestamp.start).getTime())/1e3).toFixed(2)}
              seconds)`:"Still running"}
        </ha-timeline>
      `),i.dy`${e}`}},{kind:"method",key:"updated",value:function(e){if(me(ve(r.prototype),"updated",this).call(this,e),this.allowPick&&e.has("trace")&&this.trace&&this.selectedPath&&!(this.selectedPath in this.trace.trace)){const e=this.shadowRoot.querySelector("ha-timeline[data-path]");e&&((0,s.B)(this,"value-changed",{value:e.dataset.path}),this.selectedPath=e.dataset.path)}(e.has("trace")||e.has("selectedPath"))&&this.shadowRoot.querySelectorAll("ha-timeline[data-path]").forEach((e=>{e.style.setProperty("--timeline-ball-color",this.selectedPath===e.dataset.path?"var(--primary-color)":null),this.allowPick&&!e.dataset.upgraded&&(e.dataset.upgraded="1",e.addEventListener("click",(()=>{this.selectedPath=e.dataset.path,(0,s.B)(this,"value-changed",{value:e.dataset.path})})),e.addEventListener("mouseover",(()=>{e.raised=!0})),e.addEventListener("mouseout",(()=>{e.raised=!1})))}))}},{kind:"get",static:!0,key:"styles",value:function(){return[i.iv`
        ha-timeline[lastItem].condition {
          --timeline-ball-color: var(--error-color);
        }
        ha-timeline[data-path] {
          cursor: pointer;
        }
      `]}}]}}),i.oi);function Ee(){Ee=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach((function(r){t.forEach((function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r=e.prototype;["method","field"].forEach((function(i){t.forEach((function(t){var n=t.placement;if(t.kind===i&&("static"===n||"prototype"===n)){var o="static"===n?e:r;this.defineClassElement(o,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}Object.defineProperty(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],n={static:[],prototype:[],own:[]};if(e.forEach((function(e){this.addElementPlacement(e,n)}),this),e.forEach((function(e){if(!Te(e))return r.push(e);var t=this.decorateElement(e,n);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var o=this.decorateConstructor(r,t);return i.push.apply(i,o.finishers),o.finishers=i,o},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==i.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],n=e.decorators,o=n.length-1;o>=0;o--){var s=t[e.placement];s.splice(s.indexOf(e.key),1);var a=this.fromElementDescriptor(e),c=this.toElementFinisherExtras((0,n[o])(a)||a);e=c.element,this.addElementPlacement(e,t),c.finisher&&i.push(c.finisher);var l=c.extras;if(l){for(var d=0;d<l.length;d++)this.addElementPlacement(l[d],t);r.push.apply(r,l)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var n=this.fromClassDescriptor(e),o=this.toClassDescriptor((0,t[i])(n)||n);if(void 0!==o.finisher&&r.push(o.finisher),void 0!==o.elements){e=o.elements;for(var s=0;s<e.length-1;s++)for(var a=s+1;a<e.length;a++)if(e[s].key===e[a].key&&e[s].placement===e[a].placement)throw new TypeError("Duplicated element ("+e[s].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return(t=e,function(e){if(Array.isArray(e))return e}(t)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return Ae(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ae(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=De(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var n=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var o={kind:t,key:r,placement:i,descriptor:Object.assign({},n)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(n,"get","The property descriptor of a field descriptor"),this.disallowProperty(n,"set","The property descriptor of a field descriptor"),this.disallowProperty(n,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:xe(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=xe(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function _e(e){var t,r=De(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function Pe(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function Te(e){return e.decorators&&e.decorators.length}function $e(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function xe(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function De(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}!function(e,t,r,i){var n=Ee();if(i)for(var o=0;o<i.length;o++)n=i[o](n);var s=t((function(e){n.initializeInstanceElements(e,a.elements)}),r),a=n.decorateClass(function(e){for(var t=[],r=function(e){return"method"===e.kind&&e.key===o.key&&e.placement===o.placement},i=0;i<e.length;i++){var n,o=e[i];if("method"===o.kind&&(n=t.find(r)))if($e(o.descriptor)||$e(n.descriptor)){if(Te(o)||Te(n))throw new ReferenceError("Duplicated methods ("+o.key+") can't be decorated.");n.descriptor=o.descriptor}else{if(Te(o)){if(Te(n))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+o.key+").");n.decorators=o.decorators}Pe(o,n)}else t.push(o)}return t}(s.d.map(_e)),e);n.initializeClassElements(s.F,a.elements),n.runClassFinishers(s.F,a.finishers)}([(0,i.Mo)("ha-automation-trace-timeline")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,i.Cb)()],key:"trace",value:void 0},{kind:"field",decorators:[(0,i.Cb)()],key:"logbookEntries",value:void 0},{kind:"field",decorators:[(0,i.Cb)()],key:"selected",value:void 0},{kind:"method",key:"render",value:function(){return i.dy`
      <hat-trace-timeline
        .hass=${this.hass}
        .trace=${this.trace}
        .logbookEntries=${this.logbookEntries}
        .selectedPath=${this.selected.path}
        allowPick
        @value-changed=${this._timelinePathPicked}
      >
      </hat-trace-timeline>
    `}},{kind:"method",key:"_timelinePathPicked",value:function(e){(0,s.B)(this,"value-changed",e.detail)}},{kind:"get",static:!0,key:"styles",value:function(){return[i.iv`
        :host {
          display: block;
          padding: 16px;
        }
      `]}}]}}),i.oi);function Ce(){Ce=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach((function(r){t.forEach((function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r=e.prototype;["method","field"].forEach((function(i){t.forEach((function(t){var n=t.placement;if(t.kind===i&&("static"===n||"prototype"===n)){var o="static"===n?e:r;this.defineClassElement(o,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}Object.defineProperty(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],n={static:[],prototype:[],own:[]};if(e.forEach((function(e){this.addElementPlacement(e,n)}),this),e.forEach((function(e){if(!ze(e))return r.push(e);var t=this.decorateElement(e,n);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var o=this.decorateConstructor(r,t);return i.push.apply(i,o.finishers),o.finishers=i,o},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==i.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],n=e.decorators,o=n.length-1;o>=0;o--){var s=t[e.placement];s.splice(s.indexOf(e.key),1);var a=this.fromElementDescriptor(e),c=this.toElementFinisherExtras((0,n[o])(a)||a);e=c.element,this.addElementPlacement(e,t),c.finisher&&i.push(c.finisher);var l=c.extras;if(l){for(var d=0;d<l.length;d++)this.addElementPlacement(l[d],t);r.push.apply(r,l)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var n=this.fromClassDescriptor(e),o=this.toClassDescriptor((0,t[i])(n)||n);if(void 0!==o.finisher&&r.push(o.finisher),void 0!==o.elements){e=o.elements;for(var s=0;s<e.length-1;s++)for(var a=s+1;a<e.length;a++)if(e[s].key===e[a].key&&e[s].placement===e[a].placement)throw new TypeError("Duplicated element ("+e[s].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return(t=e,function(e){if(Array.isArray(e))return e}(t)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return Fe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Fe(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=Ne(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var n=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var o={kind:t,key:r,placement:i,descriptor:Object.assign({},n)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(n,"get","The property descriptor of a field descriptor"),this.disallowProperty(n,"set","The property descriptor of a field descriptor"),this.disallowProperty(n,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:je(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=je(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function Se(e){var t,r=Ne(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function Ie(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function ze(e){return e.decorators&&e.decorators.length}function Oe(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function je(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function Ne(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function Fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}!function(e,t,r,i){var n=Ce();if(i)for(var o=0;o<i.length;o++)n=i[o](n);var s=t((function(e){n.initializeInstanceElements(e,a.elements)}),r),a=n.decorateClass(function(e){for(var t=[],r=function(e){return"method"===e.kind&&e.key===o.key&&e.placement===o.placement},i=0;i<e.length;i++){var n,o=e[i];if("method"===o.kind&&(n=t.find(r)))if(Oe(o.descriptor)||Oe(n.descriptor)){if(ze(o)||ze(n))throw new ReferenceError("Duplicated methods ("+o.key+") can't be decorated.");n.descriptor=o.descriptor}else{if(ze(o)){if(ze(n))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+o.key+").");n.decorators=o.decorators}Ie(o,n)}else t.push(o)}return t}(s.d.map(Se)),e);n.initializeClassElements(s.F,a.elements),n.runClassFinishers(s.F,a.finishers)}([(0,i.Mo)("ha-automation-trace-config")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,i.Cb)()],key:"trace",value:void 0},{kind:"method",key:"render",value:function(){return i.dy`
      <ha-code-editor
        .value=${(0,L.safeDump)(this.trace.config).trimRight()}
        readOnly
      ></ha-code-editor>
    `}},{kind:"get",static:!0,key:"styles",value:function(){return[i.iv``]}}]}}),i.oi);function Re(){Re=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach((function(r){t.forEach((function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r=e.prototype;["method","field"].forEach((function(i){t.forEach((function(t){var n=t.placement;if(t.kind===i&&("static"===n||"prototype"===n)){var o="static"===n?e:r;this.defineClassElement(o,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}Object.defineProperty(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],n={static:[],prototype:[],own:[]};if(e.forEach((function(e){this.addElementPlacement(e,n)}),this),e.forEach((function(e){if(!Le(e))return r.push(e);var t=this.decorateElement(e,n);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var o=this.decorateConstructor(r,t);return i.push.apply(i,o.finishers),o.finishers=i,o},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==i.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],n=e.decorators,o=n.length-1;o>=0;o--){var s=t[e.placement];s.splice(s.indexOf(e.key),1);var a=this.fromElementDescriptor(e),c=this.toElementFinisherExtras((0,n[o])(a)||a);e=c.element,this.addElementPlacement(e,t),c.finisher&&i.push(c.finisher);var l=c.extras;if(l){for(var d=0;d<l.length;d++)this.addElementPlacement(l[d],t);r.push.apply(r,l)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var n=this.fromClassDescriptor(e),o=this.toClassDescriptor((0,t[i])(n)||n);if(void 0!==o.finisher&&r.push(o.finisher),void 0!==o.elements){e=o.elements;for(var s=0;s<e.length-1;s++)for(var a=s+1;a<e.length;a++)if(e[s].key===e[a].key&&e[s].placement===e[a].placement)throw new TypeError("Duplicated element ("+e[s].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return(t=e,function(e){if(Array.isArray(e))return e}(t)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return He(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?He(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=We(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var n=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var o={kind:t,key:r,placement:i,descriptor:Object.assign({},n)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(n,"get","The property descriptor of a field descriptor"),this.disallowProperty(n,"set","The property descriptor of a field descriptor"),this.disallowProperty(n,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:qe(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=qe(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function Me(e){var t,r=We(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function Ue(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function Le(e){return e.decorators&&e.decorators.length}function Be(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function qe(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function We(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Ve(e,t,r){return(Ve="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ge(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}let Ye=function(e,t,r,i){var n=Re();if(i)for(var o=0;o<i.length;o++)n=i[o](n);var s=t((function(e){n.initializeInstanceElements(e,a.elements)}),r),a=n.decorateClass(function(e){for(var t=[],r=function(e){return"method"===e.kind&&e.key===o.key&&e.placement===o.placement},i=0;i<e.length;i++){var n,o=e[i];if("method"===o.kind&&(n=t.find(r)))if(Be(o.descriptor)||Be(n.descriptor)){if(Le(o)||Le(n))throw new ReferenceError("Duplicated methods ("+o.key+") can't be decorated.");n.descriptor=o.descriptor}else{if(Le(o)){if(Le(n))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+o.key+").");n.decorators=o.decorators}Ue(o,n)}else t.push(o)}return t}(s.d.map(Me)),e);return n.initializeClassElements(s.F,a.elements),n.runClassFinishers(s.F,a.finishers)}([(0,i.Mo)("ha-automation-trace")],(function(e,t){class r extends t{constructor(...t){super(...t),e(this)}}return{F:r,d:[{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,i.Cb)()],key:"automationId",value:void 0},{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"automations",value:void 0},{kind:"field",decorators:[(0,i.Cb)({type:Boolean})],key:"isWide",value:void 0},{kind:"field",decorators:[(0,i.Cb)({type:Boolean,reflect:!0})],key:"narrow",value:void 0},{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"route",value:void 0},{kind:"field",decorators:[(0,i.sz)()],key:"_entityId",value:void 0},{kind:"field",decorators:[(0,i.sz)()],key:"_traces",value:void 0},{kind:"field",decorators:[(0,i.sz)()],key:"_runId",value:void 0},{kind:"field",decorators:[(0,i.sz)()],key:"_selected",value:void 0},{kind:"field",decorators:[(0,i.sz)()],key:"_trace",value:void 0},{kind:"field",decorators:[(0,i.sz)()],key:"_logbookEntries",value:void 0},{kind:"field",decorators:[(0,i.sz)()],key:"_view",value:()=>"details"},{kind:"method",key:"render",value:function(){var e,t;const r=this._entityId?this.hass.states[this._entityId]:void 0,n=null===(e=this.shadowRoot.querySelector("hat-script-graph"))||void 0===e?void 0:e.getTrackedNodes(),o=(null==r?void 0:r.attributes.friendly_name)||this._entityId,s=i.dy`
      <mwc-icon-button label="Refresh" @click=${()=>this._loadTraces()}>
        <ha-svg-icon .path=${g.jcD}></ha-svg-icon>
      </mwc-icon-button>
      <mwc-icon-button
        .disabled=${!this._runId}
        label="Download Trace"
        @click=${this._downloadTrace}
      >
        <ha-svg-icon .path=${g.OGU}></ha-svg-icon>
      </mwc-icon-button>
    `;return i.dy`
      <hass-tabs-subpage
        .hass=${this.hass}
        .narrow=${this.narrow}
        .route=${this.route}
        .backCallback=${()=>this._backTapped()}
        .tabs=${N.configSections.automation}
      >
        ${this.narrow?i.dy`<span slot="header">
                ${o}
              </span>
              <div slot="toolbar-icon">
                ${s}
              </div>`:""}
        <div class="toolbar">
          ${this.narrow?"":i.dy`<div>
                ${o}
                <a
                  class="linkButton"
                  href="/config/automation/edit/${this.automationId}"
                >
                  <mwc-icon-button label="Edit Automation">
                    <ha-svg-icon .path=${g.r9}></ha-svg-icon>
                  </mwc-icon-button>
                </a>
              </div>`}
          ${this._traces&&this._traces.length>0?i.dy`
                <div>
                  <mwc-icon-button
                    .disabled=${this._traces[this._traces.length-1].run_id===this._runId}
                    label="Older trace"
                    @click=${this._pickOlderTrace}
                  >
                    <ha-svg-icon .path=${g.JXK}></ha-svg-icon>
                  </mwc-icon-button>
                  <select .value=${this._runId} @change=${this._pickTrace}>
                    ${(0,M.r)(this._traces,(e=>e.run_id),(e=>i.dy`<option value=${e.run_id}
                          >${(0,R.E)(new Date(e.timestamp.start),this.hass.locale)}</option
                        >`))}
                  </select>
                  <mwc-icon-button
                    .disabled=${this._traces[0].run_id===this._runId}
                    label="Newer trace"
                    @click=${this._pickNewerTrace}
                  >
                    <ha-svg-icon .path=${g.RWP}></ha-svg-icon>
                  </mwc-icon-button>
                </div>
              `:""}
          ${this.narrow?"":i.dy`<div>${s}</div>`}
        </div>

        ${void 0===this._traces?"Loading…":0===this._traces.length?"No traces found":void 0===this._trace?"":i.dy`
              <div class="main">
                <div class="graph">
                  <hat-script-graph
                    .trace=${this._trace}
                    .selected=${null===(t=this._selected)||void 0===t?void 0:t.path}
                    @graph-node-selected=${this._pickNode}
                  ></hat-script-graph>
                </div>

                <div class="info">
                  <div class="tabs top">
                    ${[["details","Step Details"],["timeline","Trace Timeline"],["config","Automation Config"]].map((([e,t])=>i.dy`
                        <div
                          .view=${e}
                          class=${(0,a.$)({active:this._view===e})}
                          @click=${this._showTab}
                        >
                          ${t}
                        </div>
                      `))}
                  </div>
                  ${void 0===this._selected||void 0===this._logbookEntries||void 0===n?"":"details"===this._view?i.dy`
                        <ha-automation-trace-path-details
                          .hass=${this.hass}
                          .narrow=${this.narrow}
                          .trace=${this._trace}
                          .selected=${this._selected}
                          .logbookEntries=${this._logbookEntries}
                          .trackedNodes=${n}
                        ></ha-automation-trace-path-details>
                      `:"config"===this._view?i.dy`
                        <ha-automation-trace-config
                          .hass=${this.hass}
                          .trace=${this._trace}
                        ></ha-automation-trace-config>
                      `:i.dy`
                        <ha-automation-trace-timeline
                          .hass=${this.hass}
                          .trace=${this._trace}
                          .logbookEntries=${this._logbookEntries}
                          .selected=${this._selected}
                          @value-changed=${this._timelinePathPicked}
                        ></ha-automation-trace-timeline>
                      `}
                </div>
              </div>
            `}
      </hass-tabs-subpage>
    `}},{kind:"method",key:"firstUpdated",value:function(e){if(Ve(Ge(r.prototype),"firstUpdated",this).call(this,e),!this.automationId)return;const t=new URLSearchParams(location.search);this._loadTraces(t.get("run_id")||void 0)}},{kind:"method",key:"updated",value:function(e){if(Ve(Ge(r.prototype),"updated",this).call(this,e),e.get("automationId")&&(this._traces=void 0,this._entityId=void 0,this._runId=void 0,this._trace=void 0,this._logbookEntries=void 0,this.automationId&&this._loadTraces()),e.has("_runId")&&this._runId&&(this._trace=void 0,this._logbookEntries=void 0,this.shadowRoot.querySelector("select").value=this._runId,this._loadTrace()),e.has("automations")&&this.automationId&&!this._entityId){const e=this.automations.find((e=>e.attributes.id===this.automationId));this._entityId=null==e?void 0:e.entity_id}}},{kind:"method",key:"_pickOlderTrace",value:function(){const e=this._traces.findIndex((e=>e.run_id===this._runId));this._runId=this._traces[e+1].run_id,this._selected=void 0}},{kind:"method",key:"_pickNewerTrace",value:function(){const e=this._traces.findIndex((e=>e.run_id===this._runId));this._runId=this._traces[e-1].run_id,this._selected=void 0}},{kind:"method",key:"_pickTrace",value:function(e){this._runId=e.target.value,this._selected=void 0}},{kind:"method",key:"_pickNode",value:function(e){this._selected=e.detail}},{kind:"method",key:"_loadTraces",value:async function(e){if(this._traces=await(0,n.lj)(this.hass,"automation",this.automationId),this._traces.reverse(),e&&(this._runId=e),this._runId&&!this._traces.some((e=>e.run_id===this._runId))){if(this._runId=void 0,this._selected=void 0,e){const e=new URLSearchParams(location.search);e.delete("run_id"),history.replaceState(null,"",`${location.pathname}?${e.toString()}`)}await(0,U.Ys)(this,{text:"Chosen trace is no longer available"})}!this._runId&&this._traces.length>0&&(this._runId=this._traces[0].run_id)}},{kind:"method",key:"_loadTrace",value:async function(){const e=await(0,n.mA)(this.hass,"automation",this.automationId,this._runId);this._logbookEntries=await(0,F.sS)(this.hass,e.timestamp.start,e.context.id),this._trace=e}},{kind:"method",key:"_backTapped",value:function(){history.back()}},{kind:"method",key:"_downloadTrace",value:function(){const e=document.createElement("a");e.download=`trace ${this._entityId} ${this._trace.timestamp.start}.json`,e.href=`data:application/json;charset=utf-8,${encodeURI(JSON.stringify({trace:this._trace,logbookEntries:this._logbookEntries},void 0,2))}`,e.click()}},{kind:"method",key:"_showTab",value:function(e){this._view=e.target.view}},{kind:"method",key:"_timelinePathPicked",value:function(e){var t;const r=e.detail.value,i=this.shadowRoot.querySelector("hat-script-graph").getTrackedNodes();this._selected=null===(t=i[r])||void 0===t?void 0:t.nodeInfo}},{kind:"get",static:!0,key:"styles",value:function(){return[j.Qx,B,i.iv`
        .toolbar {
          display: flex;
          align-items: center;
          justify-content: space-between;
          font-size: 20px;
          height: var(--header-height);
          padding: 0 16px;
          background-color: var(--primary-background-color);
          font-weight: 400;
          color: var(--app-header-text-color, white);
          border-bottom: var(--app-header-border-bottom, none);
          box-sizing: border-box;
        }

        .toolbar > * {
          display: flex;
          align-items: center;
        }

        :host([narrow]) .toolbar > * {
          display: contents;
        }

        .main {
          height: calc(100% - 56px);
          display: flex;
          background-color: var(--card-background-color);
        }

        :host([narrow]) .main {
          height: auto;
          flex-direction: column;
        }

        .graph {
          border-right: 1px solid var(--divider-color);
        }

        .info {
          flex: 1;
          background-color: var(--card-background-color);
        }

        .linkButton {
          color: var(--primary-text-color);
        }
      `]}}]}}),i.oi)}}]);
//# sourceMappingURL=chunk.5ed2b4d3b9f95f25937d.js.map